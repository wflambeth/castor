<!DOCTYPE html>

<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'planner/styles.css' %}">
    <!--link rel="stylesheet" href="{% static 'planner/bootstrap.css' %}"-->
    <link rel="stylesheet" href="{% static 'planner/dragula.css' %}">
    <script defer src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script defer src="{% static 'planner/dragula.js' %}"></script>
    <script defer src="{% static 'planner/scripts_base.js' %}"></script>
    {% if user.is_authenticated %}
    <script defer src="{% static 'planner/scripts_auth.js' %}"></script>
    {% endif %}
</head>

<body>
    <header style="background-image:url('{% static 'planner/logo.png' %}')">
        {% if user.is_authenticated %}
        <span>
            <h1 id="sched-name">{{ sched_name }}</h1>
            <button id="title-edit" type="button">Edit Title</button>
            <span id="title-span" hidden>
                <form action="/update_title" method="post" id="titleform">
                    {% csrf_token %}
                    {{ form }}
                    <input type="submit" value="Update title">
                </form>
                <button id="cancel-edit" type="button">[x]</button>
            </span>
            <p>{{ user.username }}</p>
            <a href="{% url 'account_logout' %}">(log out)</a>
            <button id="submit-button">Save Schedule</button>
            {% else %}
            <h1>Welcome to C.A.S.T.O.R.</h1>
            <p>This is a demo schedule only; please first <a href="{% url 'account_login' %}">Log In</a> or <a
                    href="{% url 'account_signup' %}">Sign Up</a> if you'd like to save your schedule.</p>
            {% endif %}
    </header>
    <section id="content" class="grid-wrapper">
        <div id="schedules-list">
            {% if user.is_authenticated %}
            <h4>My schedules</h4>
            {% for sched in sched_list %}
            <div class="schedules-item" id="{{ sched.id }}_parent">
                {% if sched.id == sched_id %}
                <span>{{ sched.name }} <a id="delete-current" href="{% url 'delete' %}?id={{ sched.id }}">[x]</a></span>
                {% else %}
                <span><a href="{% url 'index' %}?id={{ sched.id }}">{{ sched.name }}</a> <a
                        data-delete-id="{{ sched.id }}" class="delete-sched" href="#">[x]</a></span>
                {% endif %}
            </div>
            {% endfor %}
            {% if sched_list|length < 10 %} <div class="schedules-item" id="create-sched">
                <a href="{% url 'create' %}">Create New Schedule</a>
        </div>
        {% endif %}
        {% endif %}
        </div>

        <div id="unscheduled">
            <h2>Required Courses</h2>
            <div class="course-container" id="req-container">
                {% for course in unsched_req %}
                <div class="course-item course" data-id="{{course.course_number}}" data-qtrs="{{course.qtrs}}" data-req="true">
                    <span class="course-number">{{ course.course_number }}</span><span class="course-title">{{ course.title }}</span>
                </div>
                {% endfor %}
            </div>
            <h2>Electives</h2>
            <div class="course-container" id="elec-container">
                {% for course in unsched_elec%}
                <div class="course-item course" data-id="{{course.course_number}}" data-qtrs="{{course.qtrs}}" data-req="false">
                    <span class="course-number">{{ course.course_number }}</span><span class="course-title">{{ course.title }}</span>
                    {% if not course.credits == 4 %}
                    <span class="course-credits">({{ course.credits }})</span>
                    {% endif %}
                    {% if not course.qtrs|length == 4 %}
                    <span class="quarterspan">
                        <span class={% if 0 in course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>W</span>
                        <span class={% if 1 in course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>S</span>
                        <span class={% if 2 in course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>S</span>
                        <span class={% if 3 in course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>F</span>
                    </span>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>

        <div id="schedule">
            <div id="schedule-wrapper" class="term-container grid-wrapper container">
                <button class="add_qtr" id="add_qtr_before">+</button>
                    {% for term, courses in sched_qtrs.items %}
                    <div class="qtr grid" id="_{{term.0}}_{{term.1}}" data-yr="{{ term.0 }}" data-qtr="{{ term.1 }}">
                        <div class="term-title">
                            <span class="term-title-span">
                                {% if term.1 == 0 %}Winter
                                {% elif term.1 == 1 %}Spring
                                {% elif term.1 == 2 %}Summer
                                {% elif term.1 == 3 %}Fall
                                {% endif %}{{term.0}}
                            </span>
                            <a href="#" {% if courses|length == 0 %}hidden{% endif %} class="delete-term" data-delete-yr="{{ term.0 }}" data-delete-qtr="{{ term.1 }}">[x]</a>
                        </div>
                        <div class="course-container" data-yr="{{ term.0 }}" data-qtr="{{ term.1 }}">
                            {% if courses|length > 0 %}
                            {% for course in courses %}
                            <div class="course-item course" data-id="{{course.course.course_number}}"
                            data-req="{% if course.course.required %}true{% else %}false{% endif %}"
                            data-qtrs="{{course.course.qtrs}}">
                            <span class="course-number">{{ course.course.course_number }}</span><span class="course-title">{{ course.course.title }}</span>
                            {% if not course.course.credits == 4 %}
                            <span class="course-credits">({{ course.course.credits }})</span>
                            {% endif %}
                            {% if not course.course.qtrs|length == 4 %}
                            <span class="quarterspan">
                                <span class={% if 0 in course.course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>W</span>
                                <span class={% if 1 in course.course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>S</span>
                                <span class={% if 2 in course.course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>S</span>
                                <span class={% if 3 in course.course.qtrs %}"active_qtr"{% else %}"inactive_qtr"{% endif %}>F</span>
                            </span>
                            {% endif %}
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="course-item placeholder">
                                <span class="empty-title course-title">(empty term)</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                <button class="add_qtr" id="add_qtr_after">+</button>
            </div>
        </div>

    </section>
    <footer>
        <script>
            const page_sched_id = {{ sched_id }};
            const paths = {
                save: "{% url 'save' %}",
                update_title: "{% url 'update_title' %}",
                delete: "{% url 'delete' %}"
            }
            const POST_changes = { 
                s: page_sched_id, 
                courses: {}, 
                dates: {
                    start: {
                        qtr: {{ 'null' }},
                        year: {{ 'null' }}
                    },
                    end: {
                        qtr: {{ 'null' }},
                        year: {{ 'null' }}
                    },
                }
              };
            const prereqs = {{ prereqs }};
            const quarters = {{ quarters }};
            const crs_idx = {{ indices }};
        </script>
    </footer>
</body>