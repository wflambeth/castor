<!DOCTYPE html>

<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'planner/styles.css' %}">
    <link rel="stylesheet" href="{% static 'planner/dragula.css' %}">
    <script defer src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script defer src="{% static 'planner/dragula.js' %}"></script>
    <script defer src="{% static 'planner/scripts_base.js' %}"></script>
    {% if user.is_authenticated %}
    <script defer src="{% static 'planner/scripts_auth.js' %}"></script>
    {% endif %}
</head>

<body>
    <header>
        {% if user.is_authenticated %}
        <span>
            <h1 id="sched-name">{{ schedule.name }}</h1><!--<a href="#" id="edit-title">(edit)</a></span>-->
            <p>{{ user.username }}</p>
            <a href="{% url 'account_logout' %}">(log out)</a>
            <button id="submit-button">Save Schedule</button>
            {% else %}
            <h1>Welcome to C.A.S.T.O.R.</h1>
            <p>This is a demo page only; please first <a href="{% url 'account_login' %}">Log In</a> or <a
                    href="{% url 'account_signup' %}">Sign Up</a> if you'd like to customize the time frame and save your schedule.</p>
            {% endif %}
    </header>
    <section id="content" class="grid-wrapper">
        <div id="schedules-list">
            {% if user.is_authenticated %}
            <h4>My schedules</h4>
            {% for sched in sched_list %}
            <div class="schedules-item" id="{{ sched.id }}_parent">
                {% if sched.id == schedule.id %}
                <span>{{ sched.name }} <a id="delete-current" href="{% url 'delete' %}?id={{ sched.id }}">[x]</a></span>
                {% else %}
                <span><a href="{% url 'index' %}?id={{ sched.id }}">{{ sched.name }}</a> <a
                        data-delete-id="{{ sched.id }}" class="delete-sched" href="#">[x]</a></span>
                {% endif %}
            </div>
            {% endfor %}
            {% if sched_list|length < 10 %} <div class="schedules-item" id="create-sched">
                <a href="{% url 'create' %}">Create New Schedule</a>
        </div>
        {% endif %}
        {% endif %}
        </div>

        <div id="unscheduled">
            <h2>Required Courses</h2>
            <div class="course-container" id="req-container">
                {% for course in unsched_req %}
                <div class="course-item" data-id="{{course.course_number}}">
                    <span class="course-title">{{ course }}</span>
                </div>
                {% endfor %}
            </div>
            <h2>Electives</h2>
            <div class="course-container" id="elec-container">
                {% for course in unsched_elec%}
                <div class="course-item" data-id="{{course.course_number}}">
                    <span class="course-title">{{ course }}</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <div id="schedule">
            <div id="schedule-wrapper" class="term-container grid-wrapper container">
                {% if user.is_authenticated %}
                <button class="add_qtr" id="add_qtr_before">+</button>
                {% endif %}
                    {% for term, courses in sched_qtrs.items %}
                    <div class="qtr grid" id="_{{term.0}}_{{term.1}}" data-yr="{{ term.0 }}" data-qtr="{{ term.1 }}">
                        <div class="term-title">{% if term.1 == 0 %}Winter
                            {% elif term.1 == 1 %}Spring
                            {% elif term.1 == 2 %}Summer
                            {% elif term.1 == 3 %}Fall
                            {% endif %}{{term.0}}
                            <a href="#" hidden class="delete-term" data-delete-yr="{{ term.0 }}" data-delete-qtr="{{ term.1 }}">[x]</a>
                        </div>
                        <div class="course-container" data-yr="{{ term.0 }}" data-qtr="{{ term.1 }}">
                            {% if courses|length > 0 %}
                            {% for course in courses %}
                            <div class="course-item" data-id="{{course.course.course_number}}">
                                <span class="course-title">{{ course.course }}</span>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="course-item empty-item">
                                <span class="empty-title course-title">placeholder: empty term</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                {% if user.is_authenticated %}
                <button class="add_qtr" id="add_qtr_after">+</button>
                {% endif %}
            </div>
        </div>

    </section>
    <footer>
        <script>
            {% if user.is_authenticated %}
            const page_sched_id = {{ schedule.id }};
            const paths = {
                save: "{% url 'save' %}",
                update_title: "{% url 'update_title' %}",
                delete: "{% url 'delete' %}"
            }
            const POST_changes = { 
                s: page_sched_id, 
                courses: {}, 
                dates: {
                    start: {
                        qtr: {{ 'null' }},
                        year: {{ 'null' }}
                    },
                    end: {
                        qtr: {{ 'null' }},
                        year: {{ 'null' }}
                    },
                }
              };
            {% else %}
            const POST_changes = {
                s: 'NULL',
                courses: {},
                dates: {
                    start: {
                        qtr: 0,
                        year: 0
                    },
                    end: {
                        qtr: 0, 
                        year: 0
                    }
                }
            };
            {% endif %}
        </script>
    </footer>
</body>